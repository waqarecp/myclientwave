"use strict";var KTAppCalendar=function(){var e,t,n,a,o,r,l,d,i,c,s,m,u,v,_,y,p=JSON.parse($("#calendar_data").val()),f={id:"",leadId:"",eventName:"",eventDescription:"",eventLocation:"",startDate:"",endDate:"",allDay:!1};const b=e=>{f.id=e.id,f.leadId=e.leadId,f.eventName=e.title,f.eventDescription=e.description,f.eventLocation=e.location,f.startDate=e.startStr,f.endDate=e.endStr,f.allDay=e.allDay};return{init:function(){const k=document.getElementById("kt_modal_add_event");(r=k.querySelector("#kt_modal_add_event_form")).querySelector('[name="calendar_event_name"]'),r.querySelector('[name="calendar_event_description"]'),r.querySelector('[name="calendar_event_location"]'),e=r.querySelector("#kt_calendar_datepicker_start_date"),t=r.querySelector("#kt_calendar_datepicker_end_date"),n=r.querySelector("#kt_calendar_datepicker_start_time"),a=r.querySelector("#kt_calendar_datepicker_end_time"),document.querySelector('[data-kt-calendar="add"]'),r.querySelector("#kt_modal_add_event_submit"),d=r.querySelector("#kt_modal_add_event_cancel"),i=k.querySelector("#kt_modal_add_event_close"),r.querySelector('[data-kt-calendar="title"]'),o=new bootstrap.Modal(k);const S=document.getElementById("kt_modal_view_event");var g,Y,D;y=new bootstrap.Modal(S),c=S.querySelector('[data-kt-calendar="event_name"]'),s=S.querySelector('[data-kt-calendar="all_day"]'),m=S.querySelector('[data-kt-calendar="event_description"]'),u=S.querySelector('[data-kt-calendar="event_location"]'),v=S.querySelector('[data-kt-calendar="event_start_date"]'),_=S.querySelector('[data-kt-calendar="event_end_date"]'),S.querySelector("#kt_modal_view_event_edit"),S.querySelector("#kt_modal_view_event_delete"),g=document.getElementById("kt_calendar_app"),(Y=moment().startOf("day")).format("YYYY-MM"),Y.clone().subtract(1,"day").format("YYYY-MM-DD"),D=Y.format("YYYY-MM-DD"),Y.clone().add(1,"day").format("YYYY-MM-DD"),new FullCalendar.Calendar(g,{eventMouseEnter:function(e){var t=e.event.extendedProps,n=document.createElement("div");n.classList.add("fc-tooltip"),n.innerHTML=`\n                <strong>Lead:</strong> ${e.event.title}<br>\n                <strong>Created By:</strong> ${t.created_by}\n                ${1==t.has_new_comments?"<br><span class='badge badge-sm badge-danger'>New Updates Available</span>":""}\n            `,n.style.position="absolute",n.style.zIndex="10001",n.style.background="#fff",n.style.border="1px solid #ccc",n.style.padding="10px",n.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",document.body.appendChild(n),e.el.addEventListener("mousemove",(function(e){n.style.left=e.pageX+10+"px",n.style.top=e.pageY+10+"px"}))},eventMouseLeave:function(e){document.querySelectorAll(".fc-tooltip").forEach((function(e){e.remove()}))},headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},initialDate:D,navLinks:!0,selectable:!0,selectMirror:!0,select:function(e){b(e)},eventClick:function(e){b({id:e.event.id,leadId:e.event.extendedProps.leadId,title:e.event.title,description:e.event.extendedProps.description,location:e.event.extendedProps.location,startStr:e.event.startStr,endStr:e.event.endStr,allDay:e.event.allDay}),(()=>{var e,t,n;y.show(),f.allDay?(e="All Day",t=moment(f.startDate).format("Do MMM, YYYY"),n=moment(f.endDate).format("Do MMM, YYYY")):(e="",t=moment(f.startDate).format("Do MMM, YYYY - h:mm a"),n=moment(f.endDate).format("Do MMM, YYYY - h:mm a")),c.innerText=f.eventName,s.innerText=e,m.innerText=f.eventDescription?f.eventDescription:"--",u.innerText=f.eventLocation?f.eventLocation:"--",v.innerText=t,_.innerText=n,document.getElementById("viewDetailsBtn").onclick=function(){f.leadId&&window.open("../leads/"+f.leadId,"_blank")},document.getElementById("eventName").onclick=function(){f.leadId&&window.open("../leads/"+f.leadId,"_blank")}})()},editable:!0,dayMaxEvents:!0,events:p,datesSet:function(){},eventDidMount:function(e){var t=e.event.extendedProps;if(t.colorCode)e.el.style.backgroundColor=t.colorCode,e.el.style.borderColor=t.colorCode;else{e.el.style.backgroundColor="#fff",e.el.style.border="1px solid #ccc";const t=e.el.querySelector(".fc-event-main");t&&(t.style.color="#000")}}}).render(),l=FormValidation.formValidation(r,{fields:{calendar_event_name:{validators:{notEmpty:{message:"Event name is required"}}},calendar_event_start_date:{validators:{notEmpty:{message:"Start date is required"}}},calendar_event_end_date:{validators:{notEmpty:{message:"End date is required"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),flatpickr(e,{enableTime:!1,dateFormat:"Y-m-d"}),flatpickr(t,{enableTime:!1,dateFormat:"Y-m-d"}),flatpickr(n,{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}),flatpickr(a,{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}),d.addEventListener("click",(function(e){e.preventDefault(),Swal.fire({text:"Are you sure you would like to cancel?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, cancel it!",cancelButtonText:"No, return",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-active-light"}}).then((function(e){e.value?(r.reset(),o.hide()):"cancel"===e.dismiss&&Swal.fire({text:"Your form has not been cancelled!.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}))})),i.addEventListener("click",(function(e){e.preventDefault(),Swal.fire({text:"Are you sure you would like to cancel?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, cancel it!",cancelButtonText:"No, return",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-active-light"}}).then((function(e){e.value?(r.reset(),o.hide()):"cancel"===e.dismiss&&Swal.fire({text:"Your form has not been cancelled!.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}))})),(e=>{e.addEventListener("hidden.bs.modal",(e=>{l&&l.resetForm(!0)}))})(k)}}}();KTUtil.onDOMContentLoaded((function(){KTAppCalendar.init()}));
