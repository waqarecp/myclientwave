"use strict";var KTAppCalendar=function(){var e,t,n,a,o,r,d,l,i,c,s,m,u,v,f,y,p,_,D,k,b,g,S,Y,h,w,x,B,M=JSON.parse($("#calendar_data").val()),T={id:"",leadId:"",eventName:"",eventDescription:"",eventLocation:"",startDate:"",endDate:"",allDay:!1};const C=()=>{v.innerText="Add a New Event",u.show();const o=f.querySelectorAll('[data-kt-calendar="datepicker"]'),d=f.querySelector("#kt_calendar_datepicker_allday");d.addEventListener("click",(e=>{e.target.checked?o.forEach((e=>{e.classList.add("d-none")})):(l.setDate(T.startDate,!0,"Y-m-d"),o.forEach((e=>{e.classList.remove("d-none")})))})),E(T),_.addEventListener("click",(function(o){o.preventDefault(),y&&y.validate().then((function(o){console.log("validated!"),"Valid"==o?(_.setAttribute("data-kt-indicator","on"),_.disabled=!0,setTimeout((function(){_.removeAttribute("data-kt-indicator"),Swal.fire({text:"New event added to calendar!",icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then((function(o){if(o.isConfirmed){u.hide(),_.disabled=!1;let o=!1;d.checked&&(o=!0),0===c.selectedDates.length&&(o=!0);var i=moment(r.selectedDates[0]).format(),s=moment(l.selectedDates[l.selectedDates.length-1]).format();if(!o){const e=moment(r.selectedDates[0]).format("YYYY-MM-DD"),t=e;i=e+"T"+moment(c.selectedDates[0]).format("HH:mm:ss"),s=t+"T"+moment(m.selectedDates[0]).format("HH:mm:ss")}e.addEvent({id:I(),title:t.value,description:n.value,location:a.value,start:i,end:s,allDay:o}),e.render(),f.reset()}}))}),2e3)):Swal.fire({text:"Sorry, looks like there are some errors detected, please try again.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}))}))},q=()=>{var e,t,n;x.show(),T.allDay?(e="All Day",t=moment(T.startDate).format("Do MMM, YYYY"),n=moment(T.endDate).format("Do MMM, YYYY")):(e="",t=moment(T.startDate).format("Do MMM, YYYY - h:mm a"),n=moment(T.endDate).format("Do MMM, YYYY - h:mm a")),b.innerText=T.eventName,g.innerText=e,S.innerText=T.eventDescription?T.eventDescription:"--",Y.innerText=T.eventLocation?T.eventLocation:"--",h.innerText=t,w.innerText=n,document.getElementById("viewDetailsBtn").onclick=function(){T.leadId&&window.open("../leads/"+T.leadId,"_blank")},document.getElementById("eventName").onclick=function(){T.leadId&&window.open("../leads/"+T.leadId,"_blank")}},E=()=>{t.value=T.eventName?T.eventName:"",n.value=T.eventDescription?T.eventDescription:"",a.value=T.eventLocation?T.eventLocation:"",r.setDate(T.startDate,!0,"Y-m-d");const e=T.endDate?T.endDate:moment(T.startDate).format();l.setDate(e,!0,"Y-m-d");const o=f.querySelector("#kt_calendar_datepicker_allday"),d=f.querySelectorAll('[data-kt-calendar="datepicker"]');T.allDay?(o.checked=!0,d.forEach((e=>{e.classList.add("d-none")}))):(c.setDate(T.startDate,!0,"Y-m-d H:i"),m.setDate(T.endDate,!0,"Y-m-d H:i"),l.setDate(T.startDate,!0,"Y-m-d"),o.checked=!1,d.forEach((e=>{e.classList.remove("d-none")})))},L=e=>{T.id=e.id,T.leadId=e.leadId,T.eventName=e.title,T.eventDescription=e.description,T.eventLocation=e.location,T.startDate=e.startStr,T.endDate=e.endStr,T.allDay=e.allDay},I=()=>Date.now().toString()+Math.floor(1e3*Math.random()).toString();return{init:function(){const E=document.getElementById("kt_modal_add_event");f=E.querySelector("#kt_modal_add_event_form"),t=f.querySelector('[name="calendar_event_name"]'),n=f.querySelector('[name="calendar_event_description"]'),a=f.querySelector('[name="calendar_event_location"]'),o=f.querySelector("#kt_calendar_datepicker_start_date"),d=f.querySelector("#kt_calendar_datepicker_end_date"),i=f.querySelector("#kt_calendar_datepicker_start_time"),s=f.querySelector("#kt_calendar_datepicker_end_time"),p=document.querySelector('[data-kt-calendar="add"]'),_=f.querySelector("#kt_modal_add_event_submit"),D=f.querySelector("#kt_modal_add_event_cancel"),k=E.querySelector("#kt_modal_add_event_close"),v=f.querySelector('[data-kt-calendar="title"]'),u=new bootstrap.Modal(E);const I=document.getElementById("kt_modal_view_event");var N,A,F;x=new bootstrap.Modal(I),b=I.querySelector('[data-kt-calendar="event_name"]'),g=I.querySelector('[data-kt-calendar="all_day"]'),S=I.querySelector('[data-kt-calendar="event_description"]'),Y=I.querySelector('[data-kt-calendar="event_location"]'),h=I.querySelector('[data-kt-calendar="event_start_date"]'),w=I.querySelector('[data-kt-calendar="event_end_date"]'),I.querySelector("#kt_modal_view_event_edit"),B=I.querySelector("#kt_modal_view_event_delete"),N=document.getElementById("kt_calendar_app"),(A=moment().startOf("day")).format("YYYY-MM"),A.clone().subtract(1,"day").format("YYYY-MM-DD"),F=A.format("YYYY-MM-DD"),A.clone().add(1,"day").format("YYYY-MM-DD"),(e=new FullCalendar.Calendar(N,{eventMouseEnter:function(e){var t=e.event.extendedProps,n=document.createElement("div");n.classList.add("fc-tooltip"),n.innerHTML=`\n                <strong>Lead:</strong> ${e.event.title}<br>\n                <strong>Created By:</strong> ${t.created_by}\n                ${1==t.has_new_comments?"<br><span class='badge badge-sm badge-danger'>New Updates Available</span>":""}\n            `,n.style.position="absolute",n.style.zIndex="10001",n.style.background="#fff",n.style.border="1px solid #ccc",n.style.padding="10px",n.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",document.body.appendChild(n),e.el.addEventListener("mousemove",(function(e){n.style.left=e.pageX+10+"px",n.style.top=e.pageY+10+"px"}))},eventMouseLeave:function(e){document.querySelectorAll(".fc-tooltip").forEach((function(e){e.remove()}))},headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},initialDate:F,navLinks:!0,selectable:!0,selectMirror:!0,select:function(e){L(e)},eventClick:function(e){L({id:e.event.id,leadId:e.event.extendedProps.leadId,title:e.event.title,description:e.event.extendedProps.description,location:e.event.extendedProps.location,startStr:e.event.startStr,endStr:e.event.endStr,allDay:e.event.allDay}),q()},editable:!0,dayMaxEvents:!0,events:M,datesSet:function(){},eventDidMount:function(e){var t=e.event.extendedProps;t.colorCode?(e.el.style.backgroundColor=t.colorCode,e.el.style.borderColor=t.colorCode):(e.el.style.backgroundColor="#fff",e.el.style.border="1px solid #ccc")}})).render(),y=FormValidation.formValidation(f,{fields:{calendar_event_name:{validators:{notEmpty:{message:"Event name is required"}}},calendar_event_start_date:{validators:{notEmpty:{message:"Start date is required"}}},calendar_event_end_date:{validators:{notEmpty:{message:"End date is required"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),r=flatpickr(o,{enableTime:!1,dateFormat:"Y-m-d"}),l=flatpickr(d,{enableTime:!1,dateFormat:"Y-m-d"}),c=flatpickr(i,{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}),m=flatpickr(s,{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}),p.addEventListener("click",(e=>{T={id:"",eventName:"",eventDescription:"",startDate:new Date,endDate:new Date,allDay:!1},C()})),B.addEventListener("click",(t=>{t.preventDefault(),Swal.fire({text:"Are you sure you would like to delete this event?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, return",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-active-light"}}).then((function(t){t.value?(e.getEventById(T.id).remove(),x.hide()):"cancel"===t.dismiss&&Swal.fire({text:"Your event was not deleted!.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}))})),D.addEventListener("click",(function(e){e.preventDefault(),Swal.fire({text:"Are you sure you would like to cancel?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, cancel it!",cancelButtonText:"No, return",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-active-light"}}).then((function(e){e.value?(f.reset(),u.hide()):"cancel"===e.dismiss&&Swal.fire({text:"Your form has not been cancelled!.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}))})),k.addEventListener("click",(function(e){e.preventDefault(),Swal.fire({text:"Are you sure you would like to cancel?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, cancel it!",cancelButtonText:"No, return",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-active-light"}}).then((function(e){e.value?(f.reset(),u.hide()):"cancel"===e.dismiss&&Swal.fire({text:"Your form has not been cancelled!.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}))})),(e=>{e.addEventListener("hidden.bs.modal",(e=>{y&&y.resetForm(!0)}))})(E)}}}();KTUtil.onDOMContentLoaded((function(){KTAppCalendar.init()}));
